# CVE-2019-17564 - Apache Dubbo Insecure Deserialization

## Description
Apache Dubbo versions 2.7.0 to 2.7.4, 2.6.0 to 2.6.7, and all 2.5.x versions contain an insecure deserialization vulnerability that allows attackers to send malicious Java objects via HTTP POST requests, potentially leading to remote code execution.

## Vulnerability Details
- **CVE ID**: CVE-2019-17564
- **Severity**: Critical (CVSS 9.8)
- **Affected Versions**: Apache Dubbo 2.5.x, 2.6.0-2.6.7, 2.7.0-2.7.4
- **Attack Vector**: HTTP POST with malicious serialized Java objects
- **Impact**: Remote Code Execution, full compromise of Provider instance

## Testing with Nuclei Template

### Install Nuclei (if not already installed)
```bash
go install -v github.com/projectdiscovery/nuclei/v2/cmd/nuclei@latest
```

### Test with Nuclei Template
```bash
# Test with debug output
nuclei -u http://target:8080 -t http/vulnerabilities/apache/apache-dubbo-cve-2019-17564.yaml -debug

# Test with verbose output
nuclei -u http://target:8080 -t http/vulnerabilities/apache/apache-dubbo-cve-2019-17564.yaml -v

# Test with custom template path
nuclei -u http://target:8080 -t path/to/apache-dubbo-cve-2019-17564.yaml -v
```

### Test Template Syntax
```bash
# Validate template syntax
nuclei -validate -t http/vulnerabilities/apache/apache-dubbo-cve-2019-17564.yaml
```

## Setup Instructions (Docker Environment)

### 1. Build the Vulnerable Environment
```bash
# Build the Docker image
docker build -t vulnerable-dubbo-cve-2019-17564 .

# Run the vulnerable container
docker run -d -p 8080:8080 --name dubbo-vulnerable vulnerable-dubbo-cve-2019-17564
```

### 2. Using Docker Compose (Alternative)
```bash
# Start the environment
docker compose up -d

# Check logs
docker compose logs -f vulnerable-dubbo
```

### 3. Verify the Environment
```bash
# Check if the container is running
docker ps

# Check container logs
docker logs dubbo-vulnerable

# Test basic connectivity
curl http://localhost:8080/
```

## Expected Results

### Vulnerable Response
When the vulnerability is present, you should see:
- HTTP 500 or 400 status codes
- Java exception messages in the response body or headers
- Deserialization-related errors like:
  - `java.lang.ClassNotFoundException`
  - `java.io.InvalidClassException`
  - `java.lang.ClassCastException`
  - `java.io.StreamCorruptedException`
  - `java.lang.NullPointerException`

### Example Nuclei Output
```
[apache-dubbo-cve-2019-17564] [http] [critical] http://localhost:8080/ ["java.lang.NullPointerException"]
[apache-dubbo-cve-2019-17564] [http] [critical] http://localhost:8080/dubbo ["java.lang.NullPointerException"]
[apache-dubbo-cve-2019-17564] [http] [critical] http://localhost:8080/dubbo/ ["java.lang.NullPointerException"]
[INF] Scan completed in 68.894ms. 6 matches found.
```

## Debug Information

### Nuclei Debug Output
When running with `-debug` flag, you should see:
- Request details including headers and payload
- Response details including status code and body
- Matcher results showing which conditions were met
- Extractor results showing any extracted data

### Container Logs
```bash
# View real-time logs
docker logs -f dubbo-vulnerable

# View all logs
docker logs dubbo-vulnerable
```

## Troubleshooting

### Docker Issues
If you encounter Docker permission issues:
1. Use sudo: `sudo docker build -t vulnerable-dubbo-cve-2019-17564 .`
2. Check Docker permissions: `sudo usermod -aG docker $USER`
3. Restart Docker Desktop

### Template Validation
```bash
# Validate template syntax
nuclei -validate -t http/vulnerabilities/apache/apache-dubbo-cve-2019-17564.yaml
```

### Network Issues
If the target is not accessible:
1. Check if the service is running
2. Verify the port is open
3. Check firewall settings
4. Try different endpoints (`/`, `/dubbo`, `/dubbo/`)

## Cleanup
```bash
# Stop and remove the container
docker stop dubbo-vulnerable
docker rm dubbo-vulnerable

# Remove the image
docker rmi vulnerable-dubbo-cve-2019-17564

# Or using docker compose
docker compose down
```

## Files Overview
- **`apache-dubbo-cve-2019-17564.yaml`** - Nuclei template
- **`Dockerfile`** - Vulnerable environment setup
- **`docker-compose.yml`** - Easy environment management
- **`README.md`** - This documentation
- **`debug-output.txt`** - Sample debug output
- **`test-template.sh`** - Bash test script for template validation

## References
- [CVE-2019-17564](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-17564)
- [Apache Dubbo Security Advisory](https://dubbo.apache.org/en/docs3-v2/java-sdk/advanced-features-and-usage/security/)
- [Public POCs](https://github.com/fairyming/CVE-2019-17564)

## Security Notice
⚠️ **WARNING**: This environment is intentionally vulnerable and should only be used for security testing in isolated environments. Do not deploy this in production or on public networks. 